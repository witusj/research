<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Witek ten Hove">

<title>2024-07-18</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2024-07-18_files/libs/clipboard/clipboard.min.js"></script>
<script src="2024-07-18_files/libs/quarto-html/quarto.js"></script>
<script src="2024-07-18_files/libs/quarto-html/popper.min.js"></script>
<script src="2024-07-18_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2024-07-18_files/libs/quarto-html/anchor.min.js"></script>
<link href="2024-07-18_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2024-07-18_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2024-07-18_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2024-07-18_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2024-07-18_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="2024-07-18_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="2024-07-18_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="2024-07-18_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2024-07-18</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Witek ten Hove </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>Besproken met Joost:</p>
<ul>
<li>Model bouwen voor pairwise ranking.</li>
<li>Performance vergelijken met cardinal ML model</li>
<li>Computation time vergelijken:
<ul>
<li>Lindley recursion &lt;&gt; cardinal ML</li>
<li>Cardinal ML model pairwise ranking vs direct pairwise ranking</li>
</ul></li>
<li>Cardinal ML model met large objective punisment in loss function ontwikkelen</li>
</ul>
<section id="setup-and-load-data" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-load-data">Setup and load data</h2>
<div id="e8d5ef5c" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> schedule_class <span class="im">import</span> NewSchedule, generate_schedules, service_time_with_no_shows</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, StratifiedKFold, GridSearchCV</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, make_scorer, accuracy_score</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> clone</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold, train_test_split, GridSearchCV</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> chain, combinations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c295df6b" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScheduleData:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, N: <span class="bu">int</span>, T: <span class="bu">int</span>, samples, labels):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.N <span class="op">=</span> N</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.T <span class="op">=</span> T</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.samples <span class="op">=</span> samples</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.labels <span class="op">=</span> labels</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> describe_data(<span class="va">self</span>):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'N = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>N<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'T = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>T<span class="sc">}</span><span class="ss">'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">Samples'</span>,<span class="va">self</span>.samples.tail(<span class="dv">10</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">Labels'</span>, <span class="va">self</span>.labels.tail(<span class="dv">10</span>), sep <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> create_pair_list(<span class="va">self</span>, n): <span class="co"># Create a set of randomly selected pairs of schedules</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.samples)))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    Q <span class="op">=</span> random.choices(S, k<span class="op">=</span>n)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> []</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> q <span class="kw">in</span> Q:</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a list of possible choices excluding t</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        possible_choices <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> S <span class="cf">if</span> s <span class="op">!=</span> q]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Choose a random element from the possible choices</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> random.choice(possible_choices)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the chosen element to the result list</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        P.append(p)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    samples_s1 <span class="op">=</span> <span class="va">self</span>.samples.iloc[Q, :].values.tolist()</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    samples_s2 <span class="op">=</span> <span class="va">self</span>.samples.iloc[P, :].values.tolist()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.pair_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(samples_s1, samples_s2))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.lables_s1 <span class="op">=</span> <span class="va">self</span>.labels.loc[Q, <span class="st">'obj'</span>].values.tolist()</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.lables_s2 <span class="op">=</span> <span class="va">self</span>.labels.loc[P, <span class="st">'obj'</span>].values.tolist()</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.lables_rank <span class="op">=</span> [<span class="dv">1</span> <span class="op">*</span> (<span class="va">self</span>.lables_s1[i] <span class="op">&gt;</span> <span class="va">self</span>.lables_s2[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.lables_s1))]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="va">self</span>.pair_list[:<span class="dv">15</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.lables_s1[:<span class="dv">15</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.lables_s2[:<span class="dv">15</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.lables_rank[:<span class="dv">15</span>])</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> create_neighbors_list(<span class="va">self</span>, n): <span class="co"># Create a set of pairs of schedules that are from the same neighborhood</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build a subset of random schedules with length n</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.samples)))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    Q <span class="op">=</span> random.choices(S, k<span class="op">=</span>n)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    samples_sub <span class="op">=</span> <span class="va">self</span>.samples.iloc[Q, :].values.tolist()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    labels_sub <span class="op">=</span> <span class="va">self</span>.labels.iloc[Q, <span class="dv">7</span>]</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.neighbors_list <span class="op">=</span> []</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each schedule in in the subset choose 2 random intervals i, j and swap 1 patient</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s <span class="kw">in</span> samples_sub:</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      i <span class="op">=</span> random.choice(<span class="bu">range</span>(<span class="bu">len</span>(s)))  <span class="co"># Ensure i is a valid index in s</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>      j <span class="op">=</span> [index <span class="cf">for</span> index, element <span class="kw">in</span> <span class="bu">enumerate</span>(s) <span class="cf">if</span> element <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> index <span class="op">!=</span> i]</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="kw">not</span> j:  <span class="co"># Ensure j is not empty</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>          <span class="cf">continue</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>      j <span class="op">=</span> random.choice(j)  <span class="co"># Choose a random valid index from j</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>      s_pair <span class="op">=</span> s.copy()  <span class="co"># Create a copy of s to modify</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>      s_pair[i] <span class="op">=</span> s[i] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>      s_pair[j] <span class="op">=</span> s[j] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.neighbors_list.append((s, s_pair))</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(samples_sub, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.neighbors_list, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, labels_sub)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> calculate_objective(<span class="va">self</span>, schedule, s, d, q):</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> service_time_with_no_shows(s, q) <span class="co"># Adjust service times distribution for no-shows</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    sp <span class="op">=</span> np.array([<span class="dv">1</span>], dtype<span class="op">=</span>np.int64) <span class="co"># Set probability of first spillover time being zero to 1</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    wt_list <span class="op">=</span> [] <span class="co"># Initialize wt_list for saving all waiting times for all patients in the schedule</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    ewt <span class="op">=</span> <span class="dv">0</span> <span class="co"># Initialize sum of expected waiting times</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> schedule: <span class="co"># For each interval -</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(x <span class="op">==</span> <span class="dv">0</span>): <span class="co"># In case there are no patients,</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        wt_temp <span class="op">=</span> [np.array(sp)] <span class="co"># the spillover from the previous interval is recorded,</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        wt_list.append([]) <span class="co"># but there are no waiting times.</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        sp <span class="op">=</span> [] <span class="co"># Initialize the spillover time distribution </span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        sp.append(np.<span class="bu">sum</span>(wt_temp[<span class="op">-</span><span class="dv">1</span>][:d<span class="op">+</span><span class="dv">1</span>])) <span class="co"># All the work from the previous interval's spillover that could not be processed will be added to the this interval's spillover.</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        sp[<span class="dv">1</span>:] <span class="op">=</span> wt_temp[<span class="op">-</span><span class="dv">1</span>][d<span class="op">+</span><span class="dv">1</span>:]</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        wt_temp <span class="op">=</span> [np.array(sp)] <span class="co"># Initialize wt_temp for saving all waiting times for all patients in the interval. The first patient has to wait for the spillover work from the previous period.</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        ewt <span class="op">+=</span> np.dot(<span class="bu">range</span>(<span class="bu">len</span>(sp)), sp) <span class="co"># Add waiting time for first patient in interval</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(x<span class="op">-</span><span class="dv">1</span>): <span class="co"># For each patient</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>          wt <span class="op">=</span> np.convolve(wt_temp[i], s) <span class="co"># Calculate the waiting time distribution</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>          wt_temp.append(wt)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>          ewt <span class="op">+=</span> np.dot(<span class="bu">range</span>(<span class="bu">len</span>(wt)), wt)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        wt_list.append(wt_temp)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        sp <span class="op">=</span> []</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        sp.append(np.<span class="bu">sum</span>(np.convolve(wt_temp[<span class="op">-</span><span class="dv">1</span>],s)[:d<span class="op">+</span><span class="dv">1</span>])) <span class="co"># Calculate the spillover</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        sp[<span class="dv">1</span>:] <span class="op">=</span> np.convolve(wt_temp[<span class="op">-</span><span class="dv">1</span>],s)[d<span class="op">+</span><span class="dv">1</span>:]</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Schedule: </span><span class="sc">{</span>schedule<span class="sc">}</span><span class="ss">, ewt = </span><span class="sc">{</span>ewt<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'./experiments/data.pickle'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  sch_data: ScheduleData <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>sch_data.description</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>sch_data.describe_data()</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>sch_data.create_pair_list(<span class="dv">16000</span>)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>sch_data.create_neighbors_list(<span class="dv">10</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>test_sch <span class="op">=</span> sch_data.neighbors_list[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>sch_data.calculate_objective(test_sch, [<span class="fl">0.0</span>, <span class="fl">0.27</span>, <span class="fl">0.28</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>], <span class="dv">3</span>, <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N = 10
T = 7

Samples
      x_0  x_1  x_2  x_3  x_4  x_5  x_6
7998    8    1    0    1    0    0    0
7999    8    1    1    0    0    0    0
8000    8    2    0    0    0    0    0
8001    9    0    0    0    0    0    1
8002    9    0    0    0    0    1    0
8003    9    0    0    0    1    0    0
8004    9    0    0    1    0    0    0
8005    9    0    1    0    0    0    0
8006    9    1    0    0    0    0    0
8007   10    0    0    0    0    0    0

Labels
        ew_0       ew_1       ew_2      ew_3      ew_4      ew_5    ew_6  \
7998  56.672  13.192158   0.000000  9.241482  0.000000  0.000000  0.0000   
7999  56.672  13.192158  12.217911  0.000000  0.000000  0.000000  0.0000   
8000  56.672  28.408317   0.000000  0.000000  0.000000  0.000000  0.0000   
8001  72.864   0.000000   0.000000  0.000000  0.000000  0.000000  1.9547   
8002  72.864   0.000000   0.000000  0.000000  0.000000  3.858871  0.0000   
8003  72.864   0.000000   0.000000  0.000000  6.380606  0.000000  0.0000   
8004  72.864   0.000000   0.000000  9.241482  0.000000  0.000000  0.0000   
8005  72.864   0.000000  12.217883  0.000000  0.000000  0.000000  0.0000   
8006  72.864  15.216038   0.000000  0.000000  0.000000  0.000000  0.0000   
8007  91.080   0.000000   0.000000  0.000000  0.000000  0.000000  0.0000   

            obj  obj_rank  
7998  79.105640    7964.5  
7999  82.082070    7978.0  
8000  85.080317    7987.5  
8001  74.818700    7911.0  
8002  76.722871    7945.5  
8003  79.244606    7968.0  
8004  82.105482    7982.5  
8005  85.081883    7993.0  
8006  88.080038    7998.5  
8007  91.080000    8005.0  
[([5, 1, 0, 0, 4, 0, 0], [0, 0, 0, 1, 3, 1, 5]), ([1, 1, 1, 5, 0, 1, 1], [0, 0, 0, 4, 2, 0, 4]), ([1, 5, 2, 1, 1, 0, 0], [2, 0, 1, 3, 4, 0, 0]), ([5, 0, 0, 0, 2, 2, 1], [1, 2, 5, 0, 1, 1, 0]), ([1, 3, 2, 2, 0, 0, 2], [1, 0, 3, 0, 3, 1, 2]), ([4, 2, 0, 2, 0, 0, 2], [0, 0, 2, 6, 1, 0, 1]), ([2, 2, 1, 0, 0, 5, 0], [1, 0, 0, 1, 0, 4, 4]), ([0, 2, 5, 0, 0, 2, 1], [0, 7, 0, 2, 0, 1, 0]), ([0, 4, 1, 3, 1, 1, 0], [0, 0, 3, 5, 2, 0, 0]), ([0, 4, 0, 1, 0, 2, 3], [0, 0, 0, 0, 7, 2, 1]), ([1, 0, 3, 0, 0, 6, 0], [1, 4, 0, 0, 1, 1, 3]), ([0, 5, 3, 0, 0, 0, 2], [1, 3, 1, 0, 0, 4, 1]), ([1, 4, 1, 1, 0, 3, 0], [0, 6, 1, 0, 0, 2, 1]), ([1, 0, 0, 4, 0, 5, 0], [0, 3, 4, 0, 0, 1, 2]), ([1, 1, 4, 0, 4, 0, 0], [0, 0, 1, 1, 0, 5, 3])] 
 [45.83469008087551, 31.925612362191632, 54.48618002021776, 32.93638214007037, 31.903947786090264, 37.57795844587057, 30.66425452134402, 42.27419483282949, 50.09276646866054, 30.186601175812214, 37.626163200000036, 54.50807016895987, 34.52406351149628, 45.021314621440034, 37.594862272023136] 
 [44.48115841679363, 50.77680848523785, 35.95409687035906, 42.260359046783755, 28.748981569010112, 58.61060969191143, 44.81995776000003, 67.28540959597044, 64.99914126947522, 79.08352442141943, 23.652114129588547, 28.693674219611005, 51.50006045332245, 40.97090533376224, 48.03287604838404] 
 [1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0]
[[2, 2, 1, 3, 1, 0, 1], [0, 4, 2, 0, 1, 3, 0], [1, 0, 0, 0, 2, 7, 0], [3, 0, 0, 0, 2, 5, 0], [0, 6, 0, 0, 1, 0, 3], [0, 0, 0, 5, 4, 0, 1], [0, 0, 0, 0, 1, 1, 8], [3, 1, 2, 3, 0, 0, 1], [3, 0, 1, 1, 1, 4, 0], [1, 3, 1, 4, 1, 0, 0]] 
 [([2, 2, 1, 3, 1, 0, 1], [2, 2, 1, 3, 0, 0, 2]), ([0, 4, 2, 0, 1, 3, 0], [0, 5, 1, 0, 1, 3, 0]), ([1, 0, 0, 0, 2, 7, 0], [1, 0, 0, 0, 3, 6, 0]), ([3, 0, 0, 0, 2, 5, 0], [2, 0, 0, 1, 2, 5, 0]), ([0, 6, 0, 0, 1, 0, 3], [1, 6, 0, 0, 0, 0, 3]), ([0, 0, 0, 5, 4, 0, 1], [0, 0, 0, 6, 4, 0, 0]), ([0, 0, 0, 0, 1, 1, 8], [0, 0, 0, 0, 2, 0, 8]), ([3, 1, 2, 3, 0, 0, 1], [3, 1, 2, 2, 0, 0, 2]), ([3, 0, 1, 1, 1, 4, 0], [3, 0, 1, 1, 1, 3, 1]), ([1, 3, 1, 4, 1, 0, 0], [2, 3, 1, 4, 0, 0, 0])] 
 5963    29.935620
2689    42.942470
3029    54.867392
6312    35.795831
2882    43.738361
248     70.151718
12      60.141760
6793    35.779291
6450    24.214863
4681    41.492811
Name: obj, dtype: float64
Schedule: [0, 4, 2, 0, 1, 3, 0], ewt = 42.94246990549784</code></pre>
</div>
</div>
<section id="flow-chart-of-objective-calculation-method" class="level3">
<h3 class="anchored" data-anchor-id="flow-chart-of-objective-calculation-method">Flow chart of objective calculation method</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[Start] --&gt; B[Adjust service times distribution for no-shows]
    B --&gt; C[Set probability of first spillover time being zero to 1]
    C --&gt; D[Initialize wt_list and ewt &lt;/br&gt; for saving waiting times distributions and &lt;/br&gt;accumulated expected waiting time]
    D --&gt; E[Loop through each interval in schedule]
    
    E --&gt; F{Is x == 0?}
    
    F --&gt;|Yes| G[Record spillover from previous interval]
    G --&gt; H[Append empty list to wt_list]
    H --&gt; I[Initialize spillover time distribution]
    I --&gt; J[Calculate spillover for next interval]
    J --&gt; K[Continue to next interval]

    F --&gt;|No| L[Initialize wt_temp for current interval]
    L --&gt; M[Add spillover from previous interval &lt;/br&gt;as waiting time for first patient in current interval]
    M --&gt; N[Loop through each patient in interval]
    
    N --&gt; O[Calculate waiting time distribution for current patient]
    O --&gt; P[Append waiting time distribution to wt_temp]
    P --&gt; Q[Add expected waiting time for current patient to ewt]
    Q --&gt; R[Append wt_temp to wt_list]
    
    R --&gt; S[Initialize spillover time distribution]
    S --&gt; T[Calculate spillover for next interval]
    T --&gt; K[Continue to next interval]
    
    K --&gt; U[Print wt_list]
    U --&gt; V[Print schedule and ewt]
    V --&gt; W[End]

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data">Prepare data</h2>
<div id="c243ff00" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> []</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pair <span class="kw">in</span> sch_data.pair_list:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    X.append(pair[<span class="dv">0</span>] <span class="op">+</span> pair[<span class="dv">1</span>])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array(X)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array(sch_data.lables_rank)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and test sets</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-and-evaluate-model" class="level2">
<h2 class="anchored" data-anchor-id="train-and-evaluate-model">Train and evaluate model</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[Start] --&gt; B[Initialize StratifiedKFold]
    B --&gt; C[Initialize XGBClassifier]
    C --&gt; D[Set results as empty list]
    D --&gt; E[Loop through each split of cv split]
    E --&gt; F[Get train and test indices]
    F --&gt; G[Split X and y into X_train, X_test, y_train, y_test]
    G --&gt; H[Clone the classifier]
    H --&gt; I[Call fit_and_score function]
    I --&gt; J[Fit the estimator]
    J --&gt; K[Score on training set]
    J --&gt; L[Score on test set]
    K --&gt; M[Return estimator, train_score, test_score]
    L --&gt; M
    M --&gt; N[Append the results]
    N --&gt; E
    E --&gt; O[Loop ends]
    O --&gt; P[Print results]
    P --&gt; Q[End]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div id="4323cc51" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_and_score(estimator, X_train, X_test, y_train, y_test):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Fit the estimator on the train set and score it on both sets"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    estimator.fit(X_train, y_train, eval_set<span class="op">=</span>[(X_test, y_test)])</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    train_score <span class="op">=</span> estimator.score(X_train, y_train)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    test_score <span class="op">=</span> estimator.score(X_test, y_test)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> estimator, train_score, test_score</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">94</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the XGBClassifier without early stopping here</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    tree_method<span class="op">=</span><span class="st">"hist"</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    min_child_weight<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    colsample_bytree<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    early_stopping_rounds<span class="op">=</span><span class="dv">10</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_idx, test_idx <span class="kw">in</span> cv.split(X, y):</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    X_train, X_test <span class="op">=</span> X[train_idx], X[test_idx]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    y_train, y_test <span class="op">=</span> y[train_idx], y[test_idx]</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    est, train_score, test_score <span class="op">=</span> fit_and_score(</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        clone(clf), X_train, X_test, y_train, y_test</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    results.append((est, train_score, test_score))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (est, train_score, test_score) <span class="kw">in</span> <span class="bu">enumerate</span>(results):</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Fold </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> - Train Score: </span><span class="sc">{</span>train_score<span class="sc">:.4f}</span><span class="ss">, Test Score: </span><span class="sc">{</span>test_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0] validation_0-logloss:0.66704
[1] validation_0-logloss:0.64197
[2] validation_0-logloss:0.62004
[3] validation_0-logloss:0.60129
[4] validation_0-logloss:0.58462
[5] validation_0-logloss:0.56863
[6] validation_0-logloss:0.55463
[7] validation_0-logloss:0.54278
[8] validation_0-logloss:0.53183
[9] validation_0-logloss:0.52202
[10]    validation_0-logloss:0.51265
[11]    validation_0-logloss:0.50330
[12]    validation_0-logloss:0.49556
[13]    validation_0-logloss:0.48886
[14]    validation_0-logloss:0.48178
[15]    validation_0-logloss:0.47352
[16]    validation_0-logloss:0.46686
[17]    validation_0-logloss:0.45823
[18]    validation_0-logloss:0.45144
[19]    validation_0-logloss:0.44638
[20]    validation_0-logloss:0.44170
[21]    validation_0-logloss:0.43606
[22]    validation_0-logloss:0.43121
[23]    validation_0-logloss:0.42626
[24]    validation_0-logloss:0.42026
[25]    validation_0-logloss:0.41398
[26]    validation_0-logloss:0.40977
[27]    validation_0-logloss:0.40508
[28]    validation_0-logloss:0.40069
[29]    validation_0-logloss:0.39565
[30]    validation_0-logloss:0.39144
[31]    validation_0-logloss:0.38700
[32]    validation_0-logloss:0.38395
[33]    validation_0-logloss:0.38027
[34]    validation_0-logloss:0.37639
[35]    validation_0-logloss:0.37305
[36]    validation_0-logloss:0.36950
[37]    validation_0-logloss:0.36542
[38]    validation_0-logloss:0.36197
[39]    validation_0-logloss:0.35907
[40]    validation_0-logloss:0.35659
[41]    validation_0-logloss:0.35246
[42]    validation_0-logloss:0.35002
[43]    validation_0-logloss:0.34677
[44]    validation_0-logloss:0.34350
[45]    validation_0-logloss:0.34061
[46]    validation_0-logloss:0.33761
[47]    validation_0-logloss:0.33511
[48]    validation_0-logloss:0.33288
[49]    validation_0-logloss:0.33082
[50]    validation_0-logloss:0.32858
[51]    validation_0-logloss:0.32658
[52]    validation_0-logloss:0.32332
[53]    validation_0-logloss:0.32046
[54]    validation_0-logloss:0.31715
[55]    validation_0-logloss:0.31561
[56]    validation_0-logloss:0.31377
[57]    validation_0-logloss:0.31075
[58]    validation_0-logloss:0.30913
[59]    validation_0-logloss:0.30729
[60]    validation_0-logloss:0.30555
[61]    validation_0-logloss:0.30361
[62]    validation_0-logloss:0.30166
[63]    validation_0-logloss:0.29909
[64]    validation_0-logloss:0.29692
[65]    validation_0-logloss:0.29539
[66]    validation_0-logloss:0.29365
[67]    validation_0-logloss:0.29163
[68]    validation_0-logloss:0.28929
[69]    validation_0-logloss:0.28798
[70]    validation_0-logloss:0.28646
[71]    validation_0-logloss:0.28538
[72]    validation_0-logloss:0.28410
[73]    validation_0-logloss:0.28237
[74]    validation_0-logloss:0.28089
[75]    validation_0-logloss:0.27960
[76]    validation_0-logloss:0.27821
[77]    validation_0-logloss:0.27676
[78]    validation_0-logloss:0.27519
[79]    validation_0-logloss:0.27396
[80]    validation_0-logloss:0.27272
[81]    validation_0-logloss:0.27075
[82]    validation_0-logloss:0.26935
[83]    validation_0-logloss:0.26826
[84]    validation_0-logloss:0.26589
[85]    validation_0-logloss:0.26479
[86]    validation_0-logloss:0.26373
[87]    validation_0-logloss:0.26270
[88]    validation_0-logloss:0.26089
[89]    validation_0-logloss:0.25961
[90]    validation_0-logloss:0.25764
[91]    validation_0-logloss:0.25653
[92]    validation_0-logloss:0.25540
[93]    validation_0-logloss:0.25509
[94]    validation_0-logloss:0.25369
[95]    validation_0-logloss:0.25280
[96]    validation_0-logloss:0.25173
[97]    validation_0-logloss:0.25119
[98]    validation_0-logloss:0.24985
[99]    validation_0-logloss:0.24888
[0] validation_0-logloss:0.66754
[1] validation_0-logloss:0.64366
[2] validation_0-logloss:0.62159
[3] validation_0-logloss:0.60301
[4] validation_0-logloss:0.58811
[5] validation_0-logloss:0.57304
[6] validation_0-logloss:0.55969
[7] validation_0-logloss:0.54666
[8] validation_0-logloss:0.53685
[9] validation_0-logloss:0.52678
[10]    validation_0-logloss:0.51696
[11]    validation_0-logloss:0.50823
[12]    validation_0-logloss:0.49949
[13]    validation_0-logloss:0.49091
[14]    validation_0-logloss:0.48345
[15]    validation_0-logloss:0.47603
[16]    validation_0-logloss:0.46972
[17]    validation_0-logloss:0.46359
[18]    validation_0-logloss:0.45784
[19]    validation_0-logloss:0.45178
[20]    validation_0-logloss:0.44530
[21]    validation_0-logloss:0.43673
[22]    validation_0-logloss:0.43163
[23]    validation_0-logloss:0.42648
[24]    validation_0-logloss:0.42185
[25]    validation_0-logloss:0.41540
[26]    validation_0-logloss:0.41039
[27]    validation_0-logloss:0.40655
[28]    validation_0-logloss:0.40221
[29]    validation_0-logloss:0.39804
[30]    validation_0-logloss:0.39286
[31]    validation_0-logloss:0.38754
[32]    validation_0-logloss:0.38334
[33]    validation_0-logloss:0.37859
[34]    validation_0-logloss:0.37467
[35]    validation_0-logloss:0.37123
[36]    validation_0-logloss:0.36770
[37]    validation_0-logloss:0.36266
[38]    validation_0-logloss:0.35911
[39]    validation_0-logloss:0.35462
[40]    validation_0-logloss:0.35186
[41]    validation_0-logloss:0.34792
[42]    validation_0-logloss:0.34556
[43]    validation_0-logloss:0.34182
[44]    validation_0-logloss:0.33925
[45]    validation_0-logloss:0.33623
[46]    validation_0-logloss:0.33320
[47]    validation_0-logloss:0.32991
[48]    validation_0-logloss:0.32819
[49]    validation_0-logloss:0.32630
[50]    validation_0-logloss:0.32388
[51]    validation_0-logloss:0.32128
[52]    validation_0-logloss:0.31842
[53]    validation_0-logloss:0.31606
[54]    validation_0-logloss:0.31387
[55]    validation_0-logloss:0.31268
[56]    validation_0-logloss:0.30981
[57]    validation_0-logloss:0.30799
[58]    validation_0-logloss:0.30569
[59]    validation_0-logloss:0.30370
[60]    validation_0-logloss:0.30175
[61]    validation_0-logloss:0.29983
[62]    validation_0-logloss:0.29820
[63]    validation_0-logloss:0.29610
[64]    validation_0-logloss:0.29431
[65]    validation_0-logloss:0.29239
[66]    validation_0-logloss:0.29053
[67]    validation_0-logloss:0.28896
[68]    validation_0-logloss:0.28771
[69]    validation_0-logloss:0.28484
[70]    validation_0-logloss:0.28368
[71]    validation_0-logloss:0.28234
[72]    validation_0-logloss:0.28114
[73]    validation_0-logloss:0.28019
[74]    validation_0-logloss:0.27826
[75]    validation_0-logloss:0.27630
[76]    validation_0-logloss:0.27476
[77]    validation_0-logloss:0.27332
[78]    validation_0-logloss:0.27228
[79]    validation_0-logloss:0.27049
[80]    validation_0-logloss:0.26843
[81]    validation_0-logloss:0.26696
[82]    validation_0-logloss:0.26552
[83]    validation_0-logloss:0.26416
[84]    validation_0-logloss:0.26295
[85]    validation_0-logloss:0.26173
[86]    validation_0-logloss:0.26066
[87]    validation_0-logloss:0.25959
[88]    validation_0-logloss:0.25843
[89]    validation_0-logloss:0.25704
[90]    validation_0-logloss:0.25605
[91]    validation_0-logloss:0.25484
[92]    validation_0-logloss:0.25361
[93]    validation_0-logloss:0.25264
[94]    validation_0-logloss:0.25173
[95]    validation_0-logloss:0.25067
[96]    validation_0-logloss:0.24935
[97]    validation_0-logloss:0.24842
[98]    validation_0-logloss:0.24678
[99]    validation_0-logloss:0.24569
[0] validation_0-logloss:0.66716
[1] validation_0-logloss:0.64197
[2] validation_0-logloss:0.61964
[3] validation_0-logloss:0.60098
[4] validation_0-logloss:0.58559
[5] validation_0-logloss:0.57006
[6] validation_0-logloss:0.55697
[7] validation_0-logloss:0.54281
[8] validation_0-logloss:0.53207
[9] validation_0-logloss:0.52178
[10]    validation_0-logloss:0.51093
[11]    validation_0-logloss:0.50144
[12]    validation_0-logloss:0.49250
[13]    validation_0-logloss:0.48505
[14]    validation_0-logloss:0.47757
[15]    validation_0-logloss:0.46979
[16]    validation_0-logloss:0.46208
[17]    validation_0-logloss:0.45400
[18]    validation_0-logloss:0.44816
[19]    validation_0-logloss:0.44282
[20]    validation_0-logloss:0.43705
[21]    validation_0-logloss:0.43032
[22]    validation_0-logloss:0.42467
[23]    validation_0-logloss:0.41924
[24]    validation_0-logloss:0.41367
[25]    validation_0-logloss:0.40847
[26]    validation_0-logloss:0.40533
[27]    validation_0-logloss:0.40131
[28]    validation_0-logloss:0.39791
[29]    validation_0-logloss:0.39193
[30]    validation_0-logloss:0.38833
[31]    validation_0-logloss:0.38346
[32]    validation_0-logloss:0.37982
[33]    validation_0-logloss:0.37538
[34]    validation_0-logloss:0.37042
[35]    validation_0-logloss:0.36736
[36]    validation_0-logloss:0.36423
[37]    validation_0-logloss:0.35971
[38]    validation_0-logloss:0.35530
[39]    validation_0-logloss:0.35203
[40]    validation_0-logloss:0.34851
[41]    validation_0-logloss:0.34415
[42]    validation_0-logloss:0.34082
[43]    validation_0-logloss:0.33693
[44]    validation_0-logloss:0.33408
[45]    validation_0-logloss:0.33168
[46]    validation_0-logloss:0.32832
[47]    validation_0-logloss:0.32464
[48]    validation_0-logloss:0.32291
[49]    validation_0-logloss:0.32065
[50]    validation_0-logloss:0.31809
[51]    validation_0-logloss:0.31611
[52]    validation_0-logloss:0.31384
[53]    validation_0-logloss:0.31161
[54]    validation_0-logloss:0.30955
[55]    validation_0-logloss:0.30677
[56]    validation_0-logloss:0.30409
[57]    validation_0-logloss:0.30121
[58]    validation_0-logloss:0.29908
[59]    validation_0-logloss:0.29649
[60]    validation_0-logloss:0.29427
[61]    validation_0-logloss:0.29233
[62]    validation_0-logloss:0.29096
[63]    validation_0-logloss:0.28932
[64]    validation_0-logloss:0.28800
[65]    validation_0-logloss:0.28596
[66]    validation_0-logloss:0.28452
[67]    validation_0-logloss:0.28181
[68]    validation_0-logloss:0.28003
[69]    validation_0-logloss:0.27823
[70]    validation_0-logloss:0.27653
[71]    validation_0-logloss:0.27482
[72]    validation_0-logloss:0.27305
[73]    validation_0-logloss:0.27103
[74]    validation_0-logloss:0.26926
[75]    validation_0-logloss:0.26845
[76]    validation_0-logloss:0.26723
[77]    validation_0-logloss:0.26573
[78]    validation_0-logloss:0.26405
[79]    validation_0-logloss:0.26299
[80]    validation_0-logloss:0.26201
[81]    validation_0-logloss:0.26009
[82]    validation_0-logloss:0.25872
[83]    validation_0-logloss:0.25748
[84]    validation_0-logloss:0.25512
[85]    validation_0-logloss:0.25418
[86]    validation_0-logloss:0.25303
[87]    validation_0-logloss:0.25181
[88]    validation_0-logloss:0.25062
[89]    validation_0-logloss:0.24941
[90]    validation_0-logloss:0.24796
[91]    validation_0-logloss:0.24648
[92]    validation_0-logloss:0.24520
[93]    validation_0-logloss:0.24342
[94]    validation_0-logloss:0.24220
[95]    validation_0-logloss:0.24141
[96]    validation_0-logloss:0.24023
[97]    validation_0-logloss:0.23914
[98]    validation_0-logloss:0.23845
[99]    validation_0-logloss:0.23752
[0] validation_0-logloss:0.66855
[1] validation_0-logloss:0.64549
[2] validation_0-logloss:0.62624
[3] validation_0-logloss:0.60934
[4] validation_0-logloss:0.59387
[5] validation_0-logloss:0.57887
[6] validation_0-logloss:0.56657
[7] validation_0-logloss:0.55343
[8] validation_0-logloss:0.54458
[9] validation_0-logloss:0.53453
[10]    validation_0-logloss:0.52476
[11]    validation_0-logloss:0.51582
[12]    validation_0-logloss:0.50666
[13]    validation_0-logloss:0.49987
[14]    validation_0-logloss:0.49205
[15]    validation_0-logloss:0.48464
[16]    validation_0-logloss:0.47812
[17]    validation_0-logloss:0.46834
[18]    validation_0-logloss:0.46099
[19]    validation_0-logloss:0.45513
[20]    validation_0-logloss:0.45025
[21]    validation_0-logloss:0.44236
[22]    validation_0-logloss:0.43700
[23]    validation_0-logloss:0.43229
[24]    validation_0-logloss:0.42635
[25]    validation_0-logloss:0.42189
[26]    validation_0-logloss:0.41804
[27]    validation_0-logloss:0.41100
[28]    validation_0-logloss:0.40673
[29]    validation_0-logloss:0.40305
[30]    validation_0-logloss:0.39805
[31]    validation_0-logloss:0.39435
[32]    validation_0-logloss:0.39012
[33]    validation_0-logloss:0.38675
[34]    validation_0-logloss:0.38231
[35]    validation_0-logloss:0.37796
[36]    validation_0-logloss:0.37341
[37]    validation_0-logloss:0.36886
[38]    validation_0-logloss:0.36559
[39]    validation_0-logloss:0.36265
[40]    validation_0-logloss:0.35960
[41]    validation_0-logloss:0.35668
[42]    validation_0-logloss:0.35365
[43]    validation_0-logloss:0.34970
[44]    validation_0-logloss:0.34689
[45]    validation_0-logloss:0.34424
[46]    validation_0-logloss:0.34120
[47]    validation_0-logloss:0.33856
[48]    validation_0-logloss:0.33524
[49]    validation_0-logloss:0.33194
[50]    validation_0-logloss:0.32913
[51]    validation_0-logloss:0.32666
[52]    validation_0-logloss:0.32481
[53]    validation_0-logloss:0.32262
[54]    validation_0-logloss:0.31989
[55]    validation_0-logloss:0.31722
[56]    validation_0-logloss:0.31539
[57]    validation_0-logloss:0.31337
[58]    validation_0-logloss:0.31084
[59]    validation_0-logloss:0.30813
[60]    validation_0-logloss:0.30521
[61]    validation_0-logloss:0.30331
[62]    validation_0-logloss:0.30162
[63]    validation_0-logloss:0.29953
[64]    validation_0-logloss:0.29724
[65]    validation_0-logloss:0.29560
[66]    validation_0-logloss:0.29387
[67]    validation_0-logloss:0.29233
[68]    validation_0-logloss:0.28957
[69]    validation_0-logloss:0.28768
[70]    validation_0-logloss:0.28600
[71]    validation_0-logloss:0.28472
[72]    validation_0-logloss:0.28296
[73]    validation_0-logloss:0.28075
[74]    validation_0-logloss:0.27859
[75]    validation_0-logloss:0.27731
[76]    validation_0-logloss:0.27532
[77]    validation_0-logloss:0.27388
[78]    validation_0-logloss:0.27285
[79]    validation_0-logloss:0.27144
[80]    validation_0-logloss:0.27034
[81]    validation_0-logloss:0.26838
[82]    validation_0-logloss:0.26693
[83]    validation_0-logloss:0.26556
[84]    validation_0-logloss:0.26442
[85]    validation_0-logloss:0.26327
[86]    validation_0-logloss:0.26220
[87]    validation_0-logloss:0.26138
[88]    validation_0-logloss:0.26030
[89]    validation_0-logloss:0.25889
[90]    validation_0-logloss:0.25731
[91]    validation_0-logloss:0.25634
[92]    validation_0-logloss:0.25515
[93]    validation_0-logloss:0.25355
[94]    validation_0-logloss:0.25144
[95]    validation_0-logloss:0.25061
[96]    validation_0-logloss:0.24973
[97]    validation_0-logloss:0.24850
[98]    validation_0-logloss:0.24769
[99]    validation_0-logloss:0.24648
[0] validation_0-logloss:0.66795
[1] validation_0-logloss:0.64307
[2] validation_0-logloss:0.62180
[3] validation_0-logloss:0.60377
[4] validation_0-logloss:0.58766
[5] validation_0-logloss:0.57282
[6] validation_0-logloss:0.55964
[7] validation_0-logloss:0.54693
[8] validation_0-logloss:0.53543
[9] validation_0-logloss:0.52383
[10]    validation_0-logloss:0.51443
[11]    validation_0-logloss:0.50582
[12]    validation_0-logloss:0.49701
[13]    validation_0-logloss:0.48842
[14]    validation_0-logloss:0.48054
[15]    validation_0-logloss:0.47320
[16]    validation_0-logloss:0.46709
[17]    validation_0-logloss:0.46060
[18]    validation_0-logloss:0.45414
[19]    validation_0-logloss:0.44762
[20]    validation_0-logloss:0.44270
[21]    validation_0-logloss:0.43368
[22]    validation_0-logloss:0.42713
[23]    validation_0-logloss:0.42058
[24]    validation_0-logloss:0.41481
[25]    validation_0-logloss:0.41125
[26]    validation_0-logloss:0.40636
[27]    validation_0-logloss:0.40197
[28]    validation_0-logloss:0.39744
[29]    validation_0-logloss:0.39349
[30]    validation_0-logloss:0.38787
[31]    validation_0-logloss:0.38425
[32]    validation_0-logloss:0.37907
[33]    validation_0-logloss:0.37483
[34]    validation_0-logloss:0.37053
[35]    validation_0-logloss:0.36611
[36]    validation_0-logloss:0.36280
[37]    validation_0-logloss:0.35829
[38]    validation_0-logloss:0.35528
[39]    validation_0-logloss:0.35034
[40]    validation_0-logloss:0.34683
[41]    validation_0-logloss:0.34295
[42]    validation_0-logloss:0.33934
[43]    validation_0-logloss:0.33620
[44]    validation_0-logloss:0.33224
[45]    validation_0-logloss:0.32995
[46]    validation_0-logloss:0.32745
[47]    validation_0-logloss:0.32488
[48]    validation_0-logloss:0.32174
[49]    validation_0-logloss:0.31918
[50]    validation_0-logloss:0.31699
[51]    validation_0-logloss:0.31453
[52]    validation_0-logloss:0.31189
[53]    validation_0-logloss:0.30938
[54]    validation_0-logloss:0.30604
[55]    validation_0-logloss:0.30330
[56]    validation_0-logloss:0.30019
[57]    validation_0-logloss:0.29851
[58]    validation_0-logloss:0.29711
[59]    validation_0-logloss:0.29530
[60]    validation_0-logloss:0.29295
[61]    validation_0-logloss:0.29074
[62]    validation_0-logloss:0.28918
[63]    validation_0-logloss:0.28726
[64]    validation_0-logloss:0.28528
[65]    validation_0-logloss:0.28291
[66]    validation_0-logloss:0.28100
[67]    validation_0-logloss:0.27956
[68]    validation_0-logloss:0.27750
[69]    validation_0-logloss:0.27565
[70]    validation_0-logloss:0.27258
[71]    validation_0-logloss:0.27093
[72]    validation_0-logloss:0.26875
[73]    validation_0-logloss:0.26720
[74]    validation_0-logloss:0.26488
[75]    validation_0-logloss:0.26316
[76]    validation_0-logloss:0.26194
[77]    validation_0-logloss:0.26030
[78]    validation_0-logloss:0.25878
[79]    validation_0-logloss:0.25753
[80]    validation_0-logloss:0.25643
[81]    validation_0-logloss:0.25464
[82]    validation_0-logloss:0.25307
[83]    validation_0-logloss:0.25178
[84]    validation_0-logloss:0.25069
[85]    validation_0-logloss:0.24891
[86]    validation_0-logloss:0.24698
[87]    validation_0-logloss:0.24570
[88]    validation_0-logloss:0.24463
[89]    validation_0-logloss:0.24359
[90]    validation_0-logloss:0.24207
[91]    validation_0-logloss:0.24063
[92]    validation_0-logloss:0.23935
[93]    validation_0-logloss:0.23778
[94]    validation_0-logloss:0.23666
[95]    validation_0-logloss:0.23569
[96]    validation_0-logloss:0.23482
[97]    validation_0-logloss:0.23359
[98]    validation_0-logloss:0.23215
[99]    validation_0-logloss:0.23141
Fold 1 - Train Score: 0.9662, Test Score: 0.9116
Fold 2 - Train Score: 0.9666, Test Score: 0.9175
Fold 3 - Train Score: 0.9677, Test Score: 0.9187
Fold 4 - Train Score: 0.9670, Test Score: 0.9113
Fold 5 - Train Score: 0.9663, Test Score: 0.9291</code></pre>
</div>
</div>
</section>
<section id="test" class="level2">
<h2 class="anchored" data-anchor-id="test">Test</h2>
<p>The model seems to be having trouble ranking schedules with close similarity consistently. This could indicate model overfitting. Solutions: create training sets with close pairs or add close pairs to the existing training data set.</p>
<div id="6eb008c7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model on the entire dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the XGBClassifier without early stopping here</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    tree_method<span class="op">=</span><span class="st">"hist"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    min_child_weight<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    colsample_bytree<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>clf.fit(X, y)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>input_X <span class="op">=</span> [</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>]),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>X_new <span class="op">=</span> []</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pair <span class="kw">in</span> input_X:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    X_new.append(pair[<span class="dv">0</span>] <span class="op">+</span> pair[<span class="dv">1</span>])</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the target for new data</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> clf.predict(X_new)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># If you want to get the probability estimates</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>y_pred_proba <span class="op">=</span> clf.predict_proba(X_new)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_pred = </span><span class="sc">{</span>y_pred<span class="sc">}</span><span class="ss">, </span><span class="ch">\n</span><span class="ss">y_pred_proba = </span><span class="ch">\n</span><span class="sc">{</span>y_pred_proba<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>y_pred = [0 0 1 0 0 1], 
y_pred_proba = 
[[0.76242477 0.23757525]
 [0.69124234 0.30875763]
 [0.3242296  0.6757704 ]
 [0.5743403  0.42565972]
 [0.99786097 0.00213903]
 [0.00121516 0.99878484]]</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>