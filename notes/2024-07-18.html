<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Witek ten Hove">

<title>2024-07-18</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2024-07-18_files/libs/clipboard/clipboard.min.js"></script>
<script src="2024-07-18_files/libs/quarto-html/quarto.js"></script>
<script src="2024-07-18_files/libs/quarto-html/popper.min.js"></script>
<script src="2024-07-18_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2024-07-18_files/libs/quarto-html/anchor.min.js"></script>
<link href="2024-07-18_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2024-07-18_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2024-07-18_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2024-07-18_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2024-07-18_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2024-07-18</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Witek ten Hove </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>Besproken met Joost:</p>
<ul>
<li>Model bouwen voor pairwise ranking.</li>
<li>Performance vergelijken met cardinal ML model</li>
<li>Computation time vergelijken:
<ul>
<li>Lindley recursion &lt;&gt; cardinal ML</li>
<li>Cardinal ML model pairwise ranking vs direct pairwise ranking</li>
</ul></li>
<li>Cardinal ML model met large objective punisment in loss function ontwikkelen</li>
</ul>
<section id="setup-and-load-data" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-load-data">Setup and load data</h2>
<div id="2f8a8785" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, StratifiedKFold, GridSearchCV</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, make_scorer, accuracy_score</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> clone</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold, train_test_split, GridSearchCV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f32fd960" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScheduleData:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, N: <span class="bu">int</span>, T: <span class="bu">int</span>, samples, labels):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.N <span class="op">=</span> N</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.T <span class="op">=</span> T</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.samples <span class="op">=</span> samples</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.labels <span class="op">=</span> labels</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> describe_data(<span class="va">self</span>):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'N = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>N<span class="sc">}</span><span class="ss">'</span>, <span class="ss">f'T = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>T<span class="sc">}</span><span class="ss">'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">Samples'</span>,<span class="va">self</span>.samples.tail(<span class="dv">10</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">Labels'</span>, <span class="va">self</span>.labels.tail(<span class="dv">10</span>), sep <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> create_pair_list(<span class="va">self</span>, n):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.samples)))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.T <span class="op">=</span> random.choices(S, k<span class="op">=</span>n)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.P <span class="op">=</span> []</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="va">self</span>.T:</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a list of possible choices excluding t</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        possible_choices <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> S <span class="cf">if</span> s <span class="op">!=</span> t]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Choose a random element from the possible choices</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> random.choice(possible_choices)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the chosen element to the result list</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.P.append(p)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    samples_s1 <span class="op">=</span> <span class="va">self</span>.samples.iloc[<span class="va">self</span>.T, :].values.tolist()</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    samples_s2 <span class="op">=</span> <span class="va">self</span>.samples.iloc[<span class="va">self</span>.P, :].values.tolist()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.pair_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(samples_s1, samples_s2))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.lables_s1 <span class="op">=</span> <span class="va">self</span>.labels.loc[<span class="va">self</span>.T, <span class="st">'obj'</span>].values.tolist()</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.lables_s2 <span class="op">=</span> <span class="va">self</span>.labels.loc[<span class="va">self</span>.P, <span class="st">'obj'</span>].values.tolist()</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.lables_rank <span class="op">=</span> [<span class="dv">1</span> <span class="op">*</span> (<span class="va">self</span>.lables_s1[i] <span class="op">&gt;</span> <span class="va">self</span>.lables_s2[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.lables_s1))]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="va">self</span>.pair_list[:<span class="dv">15</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.lables_s1[:<span class="dv">15</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.lables_s2[:<span class="dv">15</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="va">self</span>.lables_rank[:<span class="dv">15</span>])</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'./experiments/data.pickle'</span>, <span class="st">'rb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  sch_data: ScheduleData <span class="op">=</span> pickle.load(<span class="bu">file</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>sch_data.description</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>sch_data.describe_data()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>sch_data.create_pair_list(<span class="dv">16000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N = 10
T = 7

Samples
      x_0  x_1  x_2  x_3  x_4  x_5  x_6
7998    8    1    0    1    0    0    0
7999    8    1    1    0    0    0    0
8000    8    2    0    0    0    0    0
8001    9    0    0    0    0    0    1
8002    9    0    0    0    0    1    0
8003    9    0    0    0    1    0    0
8004    9    0    0    1    0    0    0
8005    9    0    1    0    0    0    0
8006    9    1    0    0    0    0    0
8007   10    0    0    0    0    0    0

Labels
        ew_0       ew_1       ew_2      ew_3      ew_4      ew_5    ew_6  \
7998  56.672  13.192158   0.000000  9.241482  0.000000  0.000000  0.0000   
7999  56.672  13.192158  12.217911  0.000000  0.000000  0.000000  0.0000   
8000  56.672  28.408317   0.000000  0.000000  0.000000  0.000000  0.0000   
8001  72.864   0.000000   0.000000  0.000000  0.000000  0.000000  1.9547   
8002  72.864   0.000000   0.000000  0.000000  0.000000  3.858871  0.0000   
8003  72.864   0.000000   0.000000  0.000000  6.380606  0.000000  0.0000   
8004  72.864   0.000000   0.000000  9.241482  0.000000  0.000000  0.0000   
8005  72.864   0.000000  12.217883  0.000000  0.000000  0.000000  0.0000   
8006  72.864  15.216038   0.000000  0.000000  0.000000  0.000000  0.0000   
8007  91.080   0.000000   0.000000  0.000000  0.000000  0.000000  0.0000   

            obj  obj_rank  
7998  79.105640    7964.5  
7999  82.082070    7978.0  
8000  85.080317    7987.5  
8001  74.818700    7911.0  
8002  76.722871    7945.5  
8003  79.244606    7968.0  
8004  82.105482    7982.5  
8005  85.081883    7993.0  
8006  88.080038    7998.5  
8007  91.080000    8005.0  
[([0, 1, 1, 0, 2, 6, 0], [0, 1, 3, 0, 1, 5, 0]), ([0, 3, 2, 4, 0, 0, 1], [0, 0, 1, 0, 1, 2, 6]), ([2, 1, 1, 0, 0, 0, 6], [1, 1, 1, 0, 5, 0, 2]), ([0, 0, 5, 0, 0, 1, 4], [0, 2, 2, 1, 0, 4, 1]), ([0, 0, 1, 0, 3, 4, 2], [0, 4, 0, 3, 0, 0, 3]), ([0, 2, 1, 1, 0, 6, 0], [2, 1, 2, 0, 3, 1, 1]), ([0, 4, 0, 2, 0, 3, 1], [0, 2, 2, 0, 3, 1, 2]), ([4, 2, 0, 2, 1, 0, 1], [1, 1, 4, 1, 0, 3, 0]), ([0, 1, 1, 7, 1, 0, 0], [3, 0, 1, 1, 3, 2, 0]), ([2, 0, 3, 1, 2, 0, 2], [1, 1, 0, 2, 4, 0, 2]), ([3, 0, 3, 0, 3, 0, 1], [3, 2, 0, 0, 1, 3, 1]), ([0, 0, 0, 1, 0, 3, 6], [3, 1, 5, 1, 0, 0, 0]), ([5, 2, 0, 2, 1, 0, 0], [1, 1, 2, 1, 1, 0, 4]), ([0, 6, 2, 0, 0, 0, 2], [0, 4, 1, 0, 0, 5, 0]), ([3, 0, 2, 1, 1, 3, 0], [2, 1, 1, 1, 0, 0, 5])] 
 [41.56745000960004, 47.992340699450395, 35.030056960000024, 41.0399536394509, 49.66412813282054, 36.01994383360003, 34.9175355747242, 40.262857967408685, 57.14226187089351, 25.304008510771755, 29.758683309434083, 55.64828160000005, 55.681602284364025, 57.483237880437635, 25.498224160765343] 
 [33.80386578595842, 43.110476800000036, 31.62594303405578, 30.447887682366883, 35.72394971656588, 23.322027834485322, 28.45374464901042, 32.45786779962879, 26.77886618913677, 30.04792393037175, 27.130997894135543, 51.92567493079359, 19.393354279944212, 40.773631864832026, 25.962063974400014] 
 [1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0]</code></pre>
</div>
</div>
</section>
<section id="prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data">Prepare data</h2>
<div id="2ec90805" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> []</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pair <span class="kw">in</span> sch_data.pair_list:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    X.append(pair[<span class="dv">0</span>] <span class="op">+</span> pair[<span class="dv">1</span>])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array(X)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array(sch_data.lables_rank)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and test sets</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-and-evaluate-model" class="level2">
<h2 class="anchored" data-anchor-id="train-and-evaluate-model">Train and evaluate model</h2>
<div id="19b5dc5e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_and_score(estimator, X_train, X_test, y_train, y_test):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Fit the estimator on the train set and score it on both sets"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    estimator.fit(X_train, y_train, eval_set<span class="op">=</span>[(X_test, y_test)])</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    train_score <span class="op">=</span> estimator.score(X_train, y_train)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    test_score <span class="op">=</span> estimator.score(X_test, y_test)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> estimator, train_score, test_score</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">94</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the XGBClassifier without early stopping here</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    tree_method<span class="op">=</span><span class="st">"hist"</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    min_child_weight<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    colsample_bytree<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    early_stopping_rounds<span class="op">=</span><span class="dv">10</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train_idx, test_idx <span class="kw">in</span> cv.split(X, y):</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    X_train, X_test <span class="op">=</span> X[train_idx], X[test_idx]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    y_train, y_test <span class="op">=</span> y[train_idx], y[test_idx]</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    est, train_score, test_score <span class="op">=</span> fit_and_score(</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        clone(clf), X_train, X_test, y_train, y_test</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    results.append((est, train_score, test_score))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (est, train_score, test_score) <span class="kw">in</span> <span class="bu">enumerate</span>(results):</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Fold </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> - Train Score: </span><span class="sc">{</span>train_score<span class="sc">:.4f}</span><span class="ss">, Test Score: </span><span class="sc">{</span>test_score<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0] validation_0-logloss:0.66581
[1] validation_0-logloss:0.64114
[2] validation_0-logloss:0.61975
[3] validation_0-logloss:0.60265
[4] validation_0-logloss:0.58635
[5] validation_0-logloss:0.56971
[6] validation_0-logloss:0.55624
[7] validation_0-logloss:0.54196
[8] validation_0-logloss:0.53063
[9] validation_0-logloss:0.52013
[10]    validation_0-logloss:0.51077
[11]    validation_0-logloss:0.50144
[12]    validation_0-logloss:0.49370
[13]    validation_0-logloss:0.48694
[14]    validation_0-logloss:0.47955
[15]    validation_0-logloss:0.47268
[16]    validation_0-logloss:0.46469
[17]    validation_0-logloss:0.45612
[18]    validation_0-logloss:0.44911
[19]    validation_0-logloss:0.44198
[20]    validation_0-logloss:0.43583
[21]    validation_0-logloss:0.42904
[22]    validation_0-logloss:0.42298
[23]    validation_0-logloss:0.41774
[24]    validation_0-logloss:0.41274
[25]    validation_0-logloss:0.40697
[26]    validation_0-logloss:0.40312
[27]    validation_0-logloss:0.39904
[28]    validation_0-logloss:0.39474
[29]    validation_0-logloss:0.38928
[30]    validation_0-logloss:0.38591
[31]    validation_0-logloss:0.38155
[32]    validation_0-logloss:0.37674
[33]    validation_0-logloss:0.37395
[34]    validation_0-logloss:0.37042
[35]    validation_0-logloss:0.36711
[36]    validation_0-logloss:0.36380
[37]    validation_0-logloss:0.35935
[38]    validation_0-logloss:0.35615
[39]    validation_0-logloss:0.35251
[40]    validation_0-logloss:0.34884
[41]    validation_0-logloss:0.34591
[42]    validation_0-logloss:0.34361
[43]    validation_0-logloss:0.34025
[44]    validation_0-logloss:0.33642
[45]    validation_0-logloss:0.33399
[46]    validation_0-logloss:0.33070
[47]    validation_0-logloss:0.32773
[48]    validation_0-logloss:0.32428
[49]    validation_0-logloss:0.32199
[50]    validation_0-logloss:0.31862
[51]    validation_0-logloss:0.31584
[52]    validation_0-logloss:0.31303
[53]    validation_0-logloss:0.30967
[54]    validation_0-logloss:0.30756
[55]    validation_0-logloss:0.30505
[56]    validation_0-logloss:0.30265
[57]    validation_0-logloss:0.30051
[58]    validation_0-logloss:0.29821
[59]    validation_0-logloss:0.29573
[60]    validation_0-logloss:0.29317
[61]    validation_0-logloss:0.29142
[62]    validation_0-logloss:0.28966
[63]    validation_0-logloss:0.28728
[64]    validation_0-logloss:0.28550
[65]    validation_0-logloss:0.28364
[66]    validation_0-logloss:0.28230
[67]    validation_0-logloss:0.28073
[68]    validation_0-logloss:0.27801
[69]    validation_0-logloss:0.27608
[70]    validation_0-logloss:0.27403
[71]    validation_0-logloss:0.27227
[72]    validation_0-logloss:0.27022
[73]    validation_0-logloss:0.26842
[74]    validation_0-logloss:0.26709
[75]    validation_0-logloss:0.26565
[76]    validation_0-logloss:0.26459
[77]    validation_0-logloss:0.26312
[78]    validation_0-logloss:0.26221
[79]    validation_0-logloss:0.26125
[80]    validation_0-logloss:0.25928
[81]    validation_0-logloss:0.25763
[82]    validation_0-logloss:0.25674
[83]    validation_0-logloss:0.25601
[84]    validation_0-logloss:0.25469
[85]    validation_0-logloss:0.25344
[86]    validation_0-logloss:0.25153
[87]    validation_0-logloss:0.25031
[88]    validation_0-logloss:0.24887
[89]    validation_0-logloss:0.24789
[90]    validation_0-logloss:0.24718
[91]    validation_0-logloss:0.24604
[92]    validation_0-logloss:0.24471
[93]    validation_0-logloss:0.24335
[94]    validation_0-logloss:0.24210
[95]    validation_0-logloss:0.24090
[96]    validation_0-logloss:0.23924
[97]    validation_0-logloss:0.23837
[98]    validation_0-logloss:0.23731
[99]    validation_0-logloss:0.23615
[0] validation_0-logloss:0.66616
[1] validation_0-logloss:0.64102
[2] validation_0-logloss:0.61883
[3] validation_0-logloss:0.60132
[4] validation_0-logloss:0.58590
[5] validation_0-logloss:0.57090
[6] validation_0-logloss:0.55806
[7] validation_0-logloss:0.54432
[8] validation_0-logloss:0.53414
[9] validation_0-logloss:0.52375
[10]    validation_0-logloss:0.51342
[11]    validation_0-logloss:0.50499
[12]    validation_0-logloss:0.49654
[13]    validation_0-logloss:0.49001
[14]    validation_0-logloss:0.48322
[15]    validation_0-logloss:0.47537
[16]    validation_0-logloss:0.46818
[17]    validation_0-logloss:0.46062
[18]    validation_0-logloss:0.45561
[19]    validation_0-logloss:0.44972
[20]    validation_0-logloss:0.44321
[21]    validation_0-logloss:0.43826
[22]    validation_0-logloss:0.43253
[23]    validation_0-logloss:0.42786
[24]    validation_0-logloss:0.42085
[25]    validation_0-logloss:0.41549
[26]    validation_0-logloss:0.41076
[27]    validation_0-logloss:0.40702
[28]    validation_0-logloss:0.40099
[29]    validation_0-logloss:0.39763
[30]    validation_0-logloss:0.39287
[31]    validation_0-logloss:0.38906
[32]    validation_0-logloss:0.38577
[33]    validation_0-logloss:0.38246
[34]    validation_0-logloss:0.37821
[35]    validation_0-logloss:0.37472
[36]    validation_0-logloss:0.37071
[37]    validation_0-logloss:0.36577
[38]    validation_0-logloss:0.36187
[39]    validation_0-logloss:0.35916
[40]    validation_0-logloss:0.35676
[41]    validation_0-logloss:0.35250
[42]    validation_0-logloss:0.34966
[43]    validation_0-logloss:0.34611
[44]    validation_0-logloss:0.34347
[45]    validation_0-logloss:0.33970
[46]    validation_0-logloss:0.33680
[47]    validation_0-logloss:0.33431
[48]    validation_0-logloss:0.33107
[49]    validation_0-logloss:0.32840
[50]    validation_0-logloss:0.32539
[51]    validation_0-logloss:0.32292
[52]    validation_0-logloss:0.32016
[53]    validation_0-logloss:0.31844
[54]    validation_0-logloss:0.31630
[55]    validation_0-logloss:0.31390
[56]    validation_0-logloss:0.31138
[57]    validation_0-logloss:0.30939
[58]    validation_0-logloss:0.30653
[59]    validation_0-logloss:0.30514
[60]    validation_0-logloss:0.30300
[61]    validation_0-logloss:0.30123
[62]    validation_0-logloss:0.29931
[63]    validation_0-logloss:0.29680
[64]    validation_0-logloss:0.29545
[65]    validation_0-logloss:0.29360
[66]    validation_0-logloss:0.29160
[67]    validation_0-logloss:0.28938
[68]    validation_0-logloss:0.28806
[69]    validation_0-logloss:0.28621
[70]    validation_0-logloss:0.28489
[71]    validation_0-logloss:0.28390
[72]    validation_0-logloss:0.28215
[73]    validation_0-logloss:0.27991
[74]    validation_0-logloss:0.27843
[75]    validation_0-logloss:0.27628
[76]    validation_0-logloss:0.27538
[77]    validation_0-logloss:0.27395
[78]    validation_0-logloss:0.27324
[79]    validation_0-logloss:0.27208
[80]    validation_0-logloss:0.27099
[81]    validation_0-logloss:0.26939
[82]    validation_0-logloss:0.26804
[83]    validation_0-logloss:0.26714
[84]    validation_0-logloss:0.26536
[85]    validation_0-logloss:0.26443
[86]    validation_0-logloss:0.26299
[87]    validation_0-logloss:0.26171
[88]    validation_0-logloss:0.26064
[89]    validation_0-logloss:0.26006
[90]    validation_0-logloss:0.25895
[91]    validation_0-logloss:0.25784
[92]    validation_0-logloss:0.25679
[93]    validation_0-logloss:0.25544
[94]    validation_0-logloss:0.25368
[95]    validation_0-logloss:0.25215
[96]    validation_0-logloss:0.25071
[97]    validation_0-logloss:0.24994
[98]    validation_0-logloss:0.24887
[99]    validation_0-logloss:0.24817
[0] validation_0-logloss:0.66749
[1] validation_0-logloss:0.64286
[2] validation_0-logloss:0.62105
[3] validation_0-logloss:0.60379
[4] validation_0-logloss:0.58817
[5] validation_0-logloss:0.57172
[6] validation_0-logloss:0.55850
[7] validation_0-logloss:0.54524
[8] validation_0-logloss:0.53404
[9] validation_0-logloss:0.52362
[10]    validation_0-logloss:0.51324
[11]    validation_0-logloss:0.50388
[12]    validation_0-logloss:0.49622
[13]    validation_0-logloss:0.48951
[14]    validation_0-logloss:0.48246
[15]    validation_0-logloss:0.47540
[16]    validation_0-logloss:0.46910
[17]    validation_0-logloss:0.46252
[18]    validation_0-logloss:0.45666
[19]    validation_0-logloss:0.45019
[20]    validation_0-logloss:0.44453
[21]    validation_0-logloss:0.43830
[22]    validation_0-logloss:0.43316
[23]    validation_0-logloss:0.42668
[24]    validation_0-logloss:0.42221
[25]    validation_0-logloss:0.41752
[26]    validation_0-logloss:0.41262
[27]    validation_0-logloss:0.40839
[28]    validation_0-logloss:0.40358
[29]    validation_0-logloss:0.39933
[30]    validation_0-logloss:0.39497
[31]    validation_0-logloss:0.39074
[32]    validation_0-logloss:0.38709
[33]    validation_0-logloss:0.38353
[34]    validation_0-logloss:0.37901
[35]    validation_0-logloss:0.37513
[36]    validation_0-logloss:0.37294
[37]    validation_0-logloss:0.36859
[38]    validation_0-logloss:0.36583
[39]    validation_0-logloss:0.36309
[40]    validation_0-logloss:0.35914
[41]    validation_0-logloss:0.35697
[42]    validation_0-logloss:0.35490
[43]    validation_0-logloss:0.35226
[44]    validation_0-logloss:0.34952
[45]    validation_0-logloss:0.34711
[46]    validation_0-logloss:0.34401
[47]    validation_0-logloss:0.34127
[48]    validation_0-logloss:0.33879
[49]    validation_0-logloss:0.33648
[50]    validation_0-logloss:0.33372
[51]    validation_0-logloss:0.33133
[52]    validation_0-logloss:0.32872
[53]    validation_0-logloss:0.32664
[54]    validation_0-logloss:0.32462
[55]    validation_0-logloss:0.32240
[56]    validation_0-logloss:0.31992
[57]    validation_0-logloss:0.31734
[58]    validation_0-logloss:0.31522
[59]    validation_0-logloss:0.31248
[60]    validation_0-logloss:0.31052
[61]    validation_0-logloss:0.30915
[62]    validation_0-logloss:0.30724
[63]    validation_0-logloss:0.30472
[64]    validation_0-logloss:0.30280
[65]    validation_0-logloss:0.30068
[66]    validation_0-logloss:0.29997
[67]    validation_0-logloss:0.29865
[68]    validation_0-logloss:0.29683
[69]    validation_0-logloss:0.29485
[70]    validation_0-logloss:0.29338
[71]    validation_0-logloss:0.29155
[72]    validation_0-logloss:0.28971
[73]    validation_0-logloss:0.28699
[74]    validation_0-logloss:0.28488
[75]    validation_0-logloss:0.28345
[76]    validation_0-logloss:0.28208
[77]    validation_0-logloss:0.28084
[78]    validation_0-logloss:0.27940
[79]    validation_0-logloss:0.27803
[80]    validation_0-logloss:0.27670
[81]    validation_0-logloss:0.27495
[82]    validation_0-logloss:0.27331
[83]    validation_0-logloss:0.27200
[84]    validation_0-logloss:0.27092
[85]    validation_0-logloss:0.26950
[86]    validation_0-logloss:0.26798
[87]    validation_0-logloss:0.26708
[88]    validation_0-logloss:0.26579
[89]    validation_0-logloss:0.26469
[90]    validation_0-logloss:0.26342
[91]    validation_0-logloss:0.26186
[92]    validation_0-logloss:0.26068
[93]    validation_0-logloss:0.25955
[94]    validation_0-logloss:0.25808
[95]    validation_0-logloss:0.25760
[96]    validation_0-logloss:0.25645
[97]    validation_0-logloss:0.25569
[98]    validation_0-logloss:0.25503
[99]    validation_0-logloss:0.25403
[0] validation_0-logloss:0.66772
[1] validation_0-logloss:0.64299
[2] validation_0-logloss:0.62096
[3] validation_0-logloss:0.60370
[4] validation_0-logloss:0.58533
[5] validation_0-logloss:0.57128
[6] validation_0-logloss:0.55720
[7] validation_0-logloss:0.54433
[8] validation_0-logloss:0.53366
[9] validation_0-logloss:0.52265
[10]    validation_0-logloss:0.51192
[11]    validation_0-logloss:0.50216
[12]    validation_0-logloss:0.49400
[13]    validation_0-logloss:0.48692
[14]    validation_0-logloss:0.47920
[15]    validation_0-logloss:0.47172
[16]    validation_0-logloss:0.46479
[17]    validation_0-logloss:0.45937
[18]    validation_0-logloss:0.45381
[19]    validation_0-logloss:0.44820
[20]    validation_0-logloss:0.44207
[21]    validation_0-logloss:0.43392
[22]    validation_0-logloss:0.42813
[23]    validation_0-logloss:0.42379
[24]    validation_0-logloss:0.41679
[25]    validation_0-logloss:0.41276
[26]    validation_0-logloss:0.40688
[27]    validation_0-logloss:0.40222
[28]    validation_0-logloss:0.39784
[29]    validation_0-logloss:0.39297
[30]    validation_0-logloss:0.38862
[31]    validation_0-logloss:0.38350
[32]    validation_0-logloss:0.37968
[33]    validation_0-logloss:0.37529
[34]    validation_0-logloss:0.37272
[35]    validation_0-logloss:0.36779
[36]    validation_0-logloss:0.36478
[37]    validation_0-logloss:0.36082
[38]    validation_0-logloss:0.35792
[39]    validation_0-logloss:0.35445
[40]    validation_0-logloss:0.35148
[41]    validation_0-logloss:0.34870
[42]    validation_0-logloss:0.34596
[43]    validation_0-logloss:0.34105
[44]    validation_0-logloss:0.33916
[45]    validation_0-logloss:0.33638
[46]    validation_0-logloss:0.33378
[47]    validation_0-logloss:0.33137
[48]    validation_0-logloss:0.32902
[49]    validation_0-logloss:0.32658
[50]    validation_0-logloss:0.32409
[51]    validation_0-logloss:0.32114
[52]    validation_0-logloss:0.31705
[53]    validation_0-logloss:0.31363
[54]    validation_0-logloss:0.31185
[55]    validation_0-logloss:0.30950
[56]    validation_0-logloss:0.30654
[57]    validation_0-logloss:0.30430
[58]    validation_0-logloss:0.30212
[59]    validation_0-logloss:0.29945
[60]    validation_0-logloss:0.29709
[61]    validation_0-logloss:0.29523
[62]    validation_0-logloss:0.29349
[63]    validation_0-logloss:0.29149
[64]    validation_0-logloss:0.28929
[65]    validation_0-logloss:0.28658
[66]    validation_0-logloss:0.28509
[67]    validation_0-logloss:0.28368
[68]    validation_0-logloss:0.28151
[69]    validation_0-logloss:0.27975
[70]    validation_0-logloss:0.27802
[71]    validation_0-logloss:0.27623
[72]    validation_0-logloss:0.27443
[73]    validation_0-logloss:0.27316
[74]    validation_0-logloss:0.27155
[75]    validation_0-logloss:0.27041
[76]    validation_0-logloss:0.26924
[77]    validation_0-logloss:0.26718
[78]    validation_0-logloss:0.26527
[79]    validation_0-logloss:0.26380
[80]    validation_0-logloss:0.26192
[81]    validation_0-logloss:0.25990
[82]    validation_0-logloss:0.25832
[83]    validation_0-logloss:0.25750
[84]    validation_0-logloss:0.25555
[85]    validation_0-logloss:0.25429
[86]    validation_0-logloss:0.25356
[87]    validation_0-logloss:0.25209
[88]    validation_0-logloss:0.25052
[89]    validation_0-logloss:0.24927
[90]    validation_0-logloss:0.24850
[91]    validation_0-logloss:0.24713
[92]    validation_0-logloss:0.24588
[93]    validation_0-logloss:0.24475
[94]    validation_0-logloss:0.24305
[95]    validation_0-logloss:0.24159
[96]    validation_0-logloss:0.24005
[97]    validation_0-logloss:0.23887
[98]    validation_0-logloss:0.23758
[99]    validation_0-logloss:0.23658
[0] validation_0-logloss:0.66589
[1] validation_0-logloss:0.63970
[2] validation_0-logloss:0.61644
[3] validation_0-logloss:0.59795
[4] validation_0-logloss:0.58143
[5] validation_0-logloss:0.56407
[6] validation_0-logloss:0.55013
[7] validation_0-logloss:0.53588
[8] validation_0-logloss:0.52493
[9] validation_0-logloss:0.51506
[10]    validation_0-logloss:0.50370
[11]    validation_0-logloss:0.49389
[12]    validation_0-logloss:0.48588
[13]    validation_0-logloss:0.47952
[14]    validation_0-logloss:0.47225
[15]    validation_0-logloss:0.46515
[16]    validation_0-logloss:0.45896
[17]    validation_0-logloss:0.45096
[18]    validation_0-logloss:0.44295
[19]    validation_0-logloss:0.43792
[20]    validation_0-logloss:0.43198
[21]    validation_0-logloss:0.42620
[22]    validation_0-logloss:0.42041
[23]    validation_0-logloss:0.41408
[24]    validation_0-logloss:0.40815
[25]    validation_0-logloss:0.40298
[26]    validation_0-logloss:0.39699
[27]    validation_0-logloss:0.39221
[28]    validation_0-logloss:0.38836
[29]    validation_0-logloss:0.38466
[30]    validation_0-logloss:0.37992
[31]    validation_0-logloss:0.37438
[32]    validation_0-logloss:0.37198
[33]    validation_0-logloss:0.36690
[34]    validation_0-logloss:0.36369
[35]    validation_0-logloss:0.36064
[36]    validation_0-logloss:0.35751
[37]    validation_0-logloss:0.35386
[38]    validation_0-logloss:0.34962
[39]    validation_0-logloss:0.34501
[40]    validation_0-logloss:0.34198
[41]    validation_0-logloss:0.33793
[42]    validation_0-logloss:0.33511
[43]    validation_0-logloss:0.33182
[44]    validation_0-logloss:0.32918
[45]    validation_0-logloss:0.32550
[46]    validation_0-logloss:0.32283
[47]    validation_0-logloss:0.31956
[48]    validation_0-logloss:0.31723
[49]    validation_0-logloss:0.31433
[50]    validation_0-logloss:0.31125
[51]    validation_0-logloss:0.30898
[52]    validation_0-logloss:0.30662
[53]    validation_0-logloss:0.30459
[54]    validation_0-logloss:0.30271
[55]    validation_0-logloss:0.30083
[56]    validation_0-logloss:0.29854
[57]    validation_0-logloss:0.29655
[58]    validation_0-logloss:0.29474
[59]    validation_0-logloss:0.29324
[60]    validation_0-logloss:0.29138
[61]    validation_0-logloss:0.28954
[62]    validation_0-logloss:0.28770
[63]    validation_0-logloss:0.28457
[64]    validation_0-logloss:0.28314
[65]    validation_0-logloss:0.28114
[66]    validation_0-logloss:0.27927
[67]    validation_0-logloss:0.27758
[68]    validation_0-logloss:0.27636
[69]    validation_0-logloss:0.27467
[70]    validation_0-logloss:0.27283
[71]    validation_0-logloss:0.27092
[72]    validation_0-logloss:0.26943
[73]    validation_0-logloss:0.26753
[74]    validation_0-logloss:0.26648
[75]    validation_0-logloss:0.26533
[76]    validation_0-logloss:0.26301
[77]    validation_0-logloss:0.26103
[78]    validation_0-logloss:0.25915
[79]    validation_0-logloss:0.25780
[80]    validation_0-logloss:0.25672
[81]    validation_0-logloss:0.25539
[82]    validation_0-logloss:0.25405
[83]    validation_0-logloss:0.25291
[84]    validation_0-logloss:0.25163
[85]    validation_0-logloss:0.25021
[86]    validation_0-logloss:0.24816
[87]    validation_0-logloss:0.24718
[88]    validation_0-logloss:0.24605
[89]    validation_0-logloss:0.24490
[90]    validation_0-logloss:0.24389
[91]    validation_0-logloss:0.24283
[92]    validation_0-logloss:0.24138
[93]    validation_0-logloss:0.23991
[94]    validation_0-logloss:0.23854
[95]    validation_0-logloss:0.23743
[96]    validation_0-logloss:0.23623
[97]    validation_0-logloss:0.23524
[98]    validation_0-logloss:0.23453
[99]    validation_0-logloss:0.23383
Fold 1 - Train Score: 0.9657, Test Score: 0.9234
Fold 2 - Train Score: 0.9665, Test Score: 0.9147
Fold 3 - Train Score: 0.9646, Test Score: 0.9091
Fold 4 - Train Score: 0.9663, Test Score: 0.9237
Fold 5 - Train Score: 0.9652, Test Score: 0.9263</code></pre>
</div>
</div>
</section>
<section id="test" class="level2">
<h2 class="anchored" data-anchor-id="test">Test</h2>
<p>The model seems to be having trouble ranking schedules with close similarity consistently. This could indicate model overfitting. Solutions: create training sets with close pairs or add close pairs to the existing training data set.</p>
<div id="cc6f70b9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model on the entire dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the XGBClassifier without early stopping here</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    tree_method<span class="op">=</span><span class="st">"hist"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    min_child_weight<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    subsample<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    colsample_bytree<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>clf.fit(X, y)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>input_X <span class="op">=</span> [</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>]),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            ([<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>X_new <span class="op">=</span> []</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pair <span class="kw">in</span> input_X:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    X_new.append(pair[<span class="dv">0</span>] <span class="op">+</span> pair[<span class="dv">1</span>])</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the target for new data</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> clf.predict(X_new)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># If you want to get the probability estimates</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>y_pred_proba <span class="op">=</span> clf.predict_proba(X_new)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_pred = </span><span class="sc">{</span>y_pred<span class="sc">}</span><span class="ss">, </span><span class="ch">\n</span><span class="ss">y_pred_proba = </span><span class="ch">\n</span><span class="sc">{</span>y_pred_proba<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>y_pred = [0 1 1 0 0 1], 
y_pred_proba = 
[[0.55570775 0.44429225]
 [0.48388255 0.51611745]
 [0.36376983 0.6362302 ]
 [0.53016996 0.46983   ]
 [0.9978132  0.00218677]
 [0.0015136  0.9984864 ]]</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>